{% extends 'accounting/base.html' %}
{% load i18n %}
{% load humanize %}
{% load evelinks %}

{% block details %}
<div class="row mb-4">

    <!-- Left Panel: Name, Image, Balance -->
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-body d-flex align-items-center">

                <!-- Image -->
                <div class="me-3 text-center">
                    <img
                        src="{% if corp_id %}{{ corp_id|corporation_logo_url:128}}{% else %}{{ char_id|character_portrait_url:128 }}{% endif %}"
                        class=" rounded-circle"
                        style="object-fit:cover;">
                </div>

                <!-- Name + Balance -->
                <div>
                    <h5 class="fw-bold mb-1 display-6">
                        {% if corp_id %}
                            {{ corporation.corporation_name }}
                        {% else %}
                            {{ character.character_name }}
                        {% endif %}
                    </h5>

                    <p class="mb-1 display-6">
                        Balance:
                        <span class="{% if balance >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {{ balance|floatformat:-1|intcomma|default:"0.00" }} ISK
                        </span>
                    </p>
                </div>

            </div>
        </div>
    </div>

    <!-- Right Panel: Optional / Additional Info -->
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-body">
                <h5 class="card-title fw-bold">All ISK payments must be sent to this corporation:</h5>
                <p class="display-6 fw-bold text-info">
                    {{ corporation_name|default:"Not Set!" }}
                </p>
                <!-- Modal Button -->
                <div class="mt-3">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#guideModal">
                        View Payment Guide
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- How This Works Card with Modal Button -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title fw-bold ">How This Works</h5>
                <p class="mb-0">
                    Accounting is now simple and straightforward â€” it works like a real-world bank account or in-game wallet.
                    You no longer need to calculate exact ISK amounts or worry about reference numbers for each payment.
                    Taxes and fees are automatically charged to your account, and you can even pre-fund your balance in advance.
                    Just deposit ISK, and your account is ready to use.
                </p>

            </div>
        </div>
    </div>
</div>

{% include 'accounting/partials/modals/pay-modal.html' %}

<!-- Ledger / Transactions -->
<div class="card mb-4">
    <div class="card-body">
        <h5 class="card-title fw-bold mb-3 bg-secondary p-2 rounded text-center">Transaction Log</h5>
        <table id="ledger-table" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>{% translate "EVE Time" %}</th>
                    <th>{% translate "Type" %}</th>
                    <th>{% translate "Amount" %}</th>
                    <th>{% translate "Balance" %}</th>
                    <th>{% translate "Description" %}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="5" class="text-center">
                        {% include "accounting/partials/common/spinner.html" %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="descriptionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">{% translate "Description" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body"></div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_javascript %}
    {% if corp_id %}
        <script>
            let urlLedger = "{% url 'accounting:ajax_corporation_ledger' corp_id %}";
        </script>
    {% else %}
        <script>
            let urlLedger = "{% url 'accounting:ajax_character_ledger' char_id %}";
        </script>
    {% endif %}


    {% include "accounting/bundles/datatables2-js.html"%}
    {% include "bundles/moment-js.html" with locale=True %}
    {% include "accounting/bundles/dashboard-js.html" %}
{% endblock %}

{% block extra_css %}
    {% include "accounting/bundles/datatables2-css.html"%}
{% endblock %}
